{"version":3,"file":"main.js","sources":["../../../../../sample/util.ts","../../../../../sample/helloTriangle/main.ts"],"sourcesContent":["// Show an error dialog if there's any uncaught exception or promise rejection.\n// This gets set up on all pages that include util.ts.\nglobalThis.addEventListener('unhandledrejection', (ev) => {\n  fail(`unhandled promise rejection, please report a bug!\n  https://github.com/webgpu/webgpu-samples/issues/new\\n${ev.reason}`);\n});\nglobalThis.addEventListener('error', (ev) => {\n  fail(`uncaught exception, please report a bug!\n  https://github.com/webgpu/webgpu-samples/issues/new\\n${ev.error}`);\n});\n\n/** Shows an error dialog if getting an adapter wasn't successful. */\nexport function quitIfAdapterNotAvailable(\n  adapter: GPUAdapter | null\n): asserts adapter {\n  if (!('gpu' in navigator)) {\n    fail('navigator.gpu is not defined - WebGPU not available in this browser');\n  }\n\n  if (!adapter) {\n    fail(\"requestAdapter returned null - this sample can't run on this system\");\n  }\n}\n\nexport function quitIfLimitLessThan(\n  adapter: GPUAdapter,\n  limit: string,\n  requiredValue: number,\n  limits: Record<string, GPUSize32>\n) {\n  if (limit in adapter.limits) {\n    const limitKey = limit as keyof GPUSupportedLimits;\n    const limitValue = adapter.limits[limitKey] as number;\n    if (limitValue < requiredValue) {\n      fail(\n        `This sample can't run on this system. ${limit} is ${limitValue}, and this sample requires at least ${requiredValue}.`\n      );\n    }\n    limits[limit] = requiredValue;\n  }\n}\n\n/**\n * Shows an error dialog if getting an adapter wasn't successful or the adapter\n * does not support the given list of features.\n */\nexport function quitIfFeaturesNotAvailable(\n  adapter: GPUAdapter | null,\n  requiredFeatures: GPUFeatureName[]\n): asserts adapter {\n  quitIfAdapterNotAvailable(adapter);\n\n  for (const feature of requiredFeatures) {\n    if (!adapter.features.has(feature)) {\n      fail(\n        `This sample requires the '${feature}' feature, which is not supported by this system.`\n      );\n      return;\n    }\n  }\n}\n\nfunction supportsDirectBufferBinding(device: GPUDevice): boolean {\n  const buffer = device.createBuffer({\n    size: 16,\n    usage: GPUBufferUsage.UNIFORM,\n  });\n  const layout = device.createBindGroupLayout({\n    entries: [{ binding: 0, visibility: GPUShaderStage.FRAGMENT, buffer: {} }],\n  });\n\n  try {\n    device.createBindGroup({\n      layout,\n      entries: [{ binding: 0, resource: buffer }],\n    });\n    return true;\n  } catch {\n    return false;\n  } finally {\n    buffer.destroy();\n  }\n}\n\nfunction supportsDirectTextureBinding(device: GPUDevice): boolean {\n  const texture = device.createTexture({\n    size: [1],\n    usage: GPUTextureUsage.TEXTURE_BINDING,\n    format: 'rgba8unorm',\n  });\n  const layout = device.createBindGroupLayout({\n    entries: [{ binding: 0, visibility: GPUShaderStage.FRAGMENT, texture: {} }],\n  });\n\n  try {\n    device.createBindGroup({\n      layout,\n      entries: [{ binding: 0, resource: texture }],\n    });\n    return true;\n  } catch {\n    return false;\n  } finally {\n    texture.destroy();\n  }\n}\n\nfunction supportsDirectTextureAttachments(device: GPUDevice): boolean {\n  const texture = device.createTexture({\n    size: [1],\n    usage: GPUTextureUsage.RENDER_ATTACHMENT,\n    format: 'rgba8unorm',\n    sampleCount: 4,\n  });\n  const resolveTarget = device.createTexture({\n    size: [1],\n    usage: GPUTextureUsage.RENDER_ATTACHMENT,\n    format: 'rgba8unorm',\n  });\n  const depthTexture = device.createTexture({\n    size: [1],\n    usage: GPUTextureUsage.RENDER_ATTACHMENT,\n    format: 'depth16unorm',\n    sampleCount: 4,\n  });\n  const encoder = device.createCommandEncoder();\n  try {\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n        { view: texture, resolveTarget, loadOp: 'load', storeOp: 'store' },\n      ],\n      depthStencilAttachment: {\n        view: depthTexture,\n        depthLoadOp: 'load',\n        depthStoreOp: 'store',\n      },\n    });\n    pass.end();\n    return true;\n  } catch (e) {\n    console.error(e);\n    return false;\n  } finally {\n    encoder.finish();\n    texture.destroy();\n    resolveTarget.destroy();\n  }\n}\n\n/**\n * Shows an error dialog if getting a adapter or device wasn't successful,\n * or if/when the device is lost or has an uncaptured error. Also checks\n * for direct buffer binding, direct texture binding, and direct texture attachment binding.\n */\nexport function quitIfWebGPUNotAvailableOrMissingFeatures(\n  adapter: GPUAdapter | null,\n  device: GPUDevice | null\n): asserts device {\n  if (!device) {\n    quitIfAdapterNotAvailable(adapter);\n    fail('Unable to get a device for an unknown reason');\n    return;\n  }\n\n  device.lost.then((reason) => {\n    fail(`Device lost (\"${reason.reason}\"):\\n${reason.message}`);\n  });\n  device.addEventListener('uncapturederror', (ev) => {\n    fail(`Uncaptured error:\\n${ev.error.message}`);\n  });\n\n  if (\n    !supportsDirectBufferBinding(device) ||\n    !supportsDirectTextureBinding(device) ||\n    !supportsDirectTextureAttachments(device)\n  ) {\n    fail(\n      'Core features of WebGPU are unavailable. Please update your browser to a newer version.'\n    );\n  }\n}\n\n/** Fail by showing a console error, and dialog box if possible. */\nconst fail = (() => {\n  type ErrorOutput = { show(msg: string): void };\n\n  function createErrorOutput() {\n    if (typeof document === 'undefined') {\n      // Not implemented in workers.\n      return {\n        show(msg: string) {\n          console.error(msg);\n        },\n      };\n    }\n\n    const dialogBox = document.createElement('dialog');\n    dialogBox.close();\n    document.body.append(dialogBox);\n\n    const dialogText = document.createElement('pre');\n    dialogText.style.whiteSpace = 'pre-wrap';\n    dialogBox.append(dialogText);\n\n    const closeBtn = document.createElement('button');\n    closeBtn.textContent = 'OK';\n    closeBtn.onclick = () => dialogBox.close();\n    dialogBox.append(closeBtn);\n\n    return {\n      show(msg: string) {\n        // Don't overwrite the dialog message while it's still open\n        // (show the first error, not the most recent error).\n        if (!dialogBox.open) {\n          dialogText.textContent = msg;\n          dialogBox.showModal();\n        }\n      },\n    };\n  }\n\n  let output: ErrorOutput | undefined;\n\n  return (message: string) => {\n    if (!output) output = createErrorOutput();\n\n    output.show(message);\n    throw new Error(message);\n  };\n})();\n","import triangleVertWGSL from '../../shaders/triangle.vert.wgsl';\nimport redFragWGSL from '../../shaders/red.frag.wgsl';\nimport { quitIfWebGPUNotAvailableOrMissingFeatures } from '../util';\n\nconst canvas = document.querySelector('canvas') as HTMLCanvasElement;\nconst adapter = await navigator.gpu?.requestAdapter({\n  featureLevel: 'compatibility',\n});\nconst device = await adapter?.requestDevice();\nquitIfWebGPUNotAvailableOrMissingFeatures(adapter, device);\n\nconst context = canvas.getContext('webgpu');\n\nconst devicePixelRatio = window.devicePixelRatio;\ncanvas.width = canvas.clientWidth * devicePixelRatio;\ncanvas.height = canvas.clientHeight * devicePixelRatio;\nconst presentationFormat = navigator.gpu.getPreferredCanvasFormat();\n\ncontext.configure({\n  device,\n  format: presentationFormat,\n});\n\nconst pipeline = device.createRenderPipeline({\n  layout: 'auto',\n  vertex: {\n    module: device.createShaderModule({\n      code: triangleVertWGSL,\n    }),\n  },\n  fragment: {\n    module: device.createShaderModule({\n      code: redFragWGSL,\n    }),\n    targets: [\n      {\n        format: presentationFormat,\n      },\n    ],\n  },\n  primitive: {\n    topology: 'triangle-list',\n  },\n});\n\nfunction frame() {\n  const commandEncoder = device.createCommandEncoder();\n  const textureView = context.getCurrentTexture().createView();\n\n  const renderPassDescriptor: GPURenderPassDescriptor = {\n    colorAttachments: [\n      {\n        view: textureView,\n        clearValue: [0, 0, 0, 0], // Clear to transparent\n        loadOp: 'clear',\n        storeOp: 'store',\n      },\n    ],\n  };\n\n  const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor);\n  passEncoder.setPipeline(pipeline);\n  passEncoder.draw(3);\n  passEncoder.end();\n\n  device.queue.submit([commandEncoder.finish()]);\n  requestAnimationFrame(frame);\n}\n\nrequestAnimationFrame(frame);\n"],"names":[],"mappings":"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"}